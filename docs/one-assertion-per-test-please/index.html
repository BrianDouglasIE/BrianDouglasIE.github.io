<!DOCTYPE html>
<html lang="en" class="Robyn">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />

        <!-- Title -->
        <title>Brian Douglas' Tech Blog - One assertion per test please</title>

        <!-- Meta Description -->
        <meta name="description" content="One assertion per test please" />

        <!-- Keywords -->
        <meta
            name="keywords"
            content="Brian Douglas, tech blog, javascript,testing"
        />

        <!-- Author -->
        <meta name="author" content="Brian Douglas" />

        <!-- Open Graph / Facebook -->
        <meta property="og:type" content="website" />
        <meta
            property="og:title"
            content="Brian Douglas' Tech Blog - One assertion per test please"
        />
        <meta property="og:description" content="One assertion per test please" />
        <meta property="og:url" content="https://www.briandouglas.ie" />
        <meta
            property="og:image"
            content="https://www.briandouglas.ie/images/og-images/one-assertion-per-test-please.png"
        />
        <meta property="og:site_name" content="Brian Douglas' Tech Blog" />

        <!-- Twitter Meta -->
        <meta name="twitter:card" content="summary_large_image" />
        <meta
            name="twitter:title"
            content="Brian Douglas' Tech Blog - One assertion per test please"
        />
        <meta name="twitter:description" content="One assertion per test please" />
        <meta
            name="twitter:image"
            content="https://www.briandouglas.ie/images/og-images/one-assertion-per-test-please.png"
        />
        <meta name="twitter:site" content="@BrianDouglasIE" />

        <!-- Canonical URL -->
        <link rel="canonical" href="https://www.briandouglas.ie" />

        <!-- Favicon (Optional) -->
        <link
            rel="icon"
            href="https://www.briandouglas.ie/favicon.ico"
            type="image/x-icon"
        />

        <!-- Robots -->
        <meta name="robots" content="index, follow" />

        <!-- Favicon-->
        <link
            rel="apple-touch-icon"
            sizes="180x180"
            href="/apple-touch-icon.png"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="32x32"
            href="/favicon-32x32.png"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="16x16"
            href="/favicon-16x16.png"
        />
        <link rel="manifest" href="/site.webmanifest" />

        <link rel="stylesheet" href="/styles/briandouglas.ie.css">
    </head>
    <body class="m-0">
        <header class="site-header">
    <div class="content-md mx-auto px-sm">
        <h1 class="m-0">Brian Douglas</h1>
    </div>
</header>

        <div class="breadcrumbs">
            <nav aria-label="Breadcrumb" class="content-md mx-auto px-sm">
                <ol class="list-reset m-0">
                    <li><a href="/">Home</a></li> /
                    <li aria-current="page">One assertion per test please</li>
                </ol>
            </nav>
        </div>
        <main>
            <div class="content-md mx-auto px-sm my-md">
                <article class="post-full">
                    <header>
                        <h2>One assertion per test please</h2>
                        <p class="post-meta">
                            <time datetime="17/08/2024"
                            >August 17th, 2024</time>
                        </p>
                    </header>
                    <div class="post-content"><p>Please! when you are writing tests try to limit each test case to one <code>expect</code>.
Let's refactor the monstrosity below to understand why fewer expects and more
tests are better.</p>
<!-- more -->
<magpie-trinket>
Try your best to write test cases as if they were telling a story.
Stick to one assertion per test, and split out any shared logic into
hooks, like <code>beforeEach</code> and <code>beforeAll</code>.
</magpie-trinket>
<h2>The Monstrosity</h2>
<pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code class="language-javascript"><span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> { render, screen, fireEvent } </span><span style="color:#D73A49">from</span><span style="color:#032F62"> '@testing-library/react'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> { expect, test } </span><span style="color:#D73A49">from</span><span style="color:#032F62"> 'vitest'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> MyComponent </span><span style="color:#D73A49">from</span><span style="color:#032F62"> './MyComponent'</span><span style="color:#24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">test</span><span style="color:#24292E">(</span><span style="color:#032F62">'User Name Submit Form'</span><span style="color:#24292E">, () </span><span style="color:#D73A49">=></span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">  const</span><span style="color:#005CC5"> mockApiData</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> { user: </span><span style="color:#032F62">'John Doe'</span><span style="color:#24292E"> };</span></span>
<span class="line"><span style="color:#D73A49">  const</span><span style="color:#005CC5"> apiFetchMock</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> vi.</span><span style="color:#6F42C1">fn</span><span style="color:#24292E">(() </span><span style="color:#D73A49">=></span><span style="color:#005CC5"> Promise</span><span style="color:#24292E">.</span><span style="color:#6F42C1">resolve</span><span style="color:#24292E">(mockApiData));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">  render</span><span style="color:#24292E">(&#x3C;</span><span style="color:#005CC5">MyComponent</span><span style="color:#6F42C1"> fetchData</span><span style="color:#D73A49">=</span><span style="color:#24292E">{apiFetchMock} />);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">  const</span><span style="color:#005CC5"> header</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> screen.</span><span style="color:#6F42C1">getByText</span><span style="color:#24292E">(</span><span style="color:#032F62">/My Dashboard/</span><span style="color:#D73A49">i</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#6F42C1">  expect</span><span style="color:#24292E">(header).</span><span style="color:#6F42C1">toBeInTheDocument</span><span style="color:#24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">  const</span><span style="color:#005CC5"> button</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> screen.</span><span style="color:#6F42C1">getByRole</span><span style="color:#24292E">(</span><span style="color:#032F62">'button'</span><span style="color:#24292E">, { name:</span><span style="color:#032F62"> /Submit/</span><span style="color:#D73A49">i</span><span style="color:#24292E"> });</span></span>
<span class="line"><span style="color:#6F42C1">  expect</span><span style="color:#24292E">(button).</span><span style="color:#6F42C1">toBeInTheDocument</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#6F42C1">  expect</span><span style="color:#24292E">(button).</span><span style="color:#6F42C1">toBeDisabled</span><span style="color:#24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">  const</span><span style="color:#005CC5"> input</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> screen.</span><span style="color:#6F42C1">getByPlaceholderText</span><span style="color:#24292E">(</span><span style="color:#032F62">'Enter your name'</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#6F42C1">  expect</span><span style="color:#24292E">(input).</span><span style="color:#6F42C1">toBeInTheDocument</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#6F42C1">  expect</span><span style="color:#24292E">(input.value).</span><span style="color:#6F42C1">toBe</span><span style="color:#24292E">(</span><span style="color:#032F62">''</span><span style="color:#24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">  fireEvent.</span><span style="color:#6F42C1">change</span><span style="color:#24292E">(input, { target: { value: </span><span style="color:#032F62">'John Doe'</span><span style="color:#24292E"> } });</span></span>
<span class="line"><span style="color:#6F42C1">  expect</span><span style="color:#24292E">(input.value).</span><span style="color:#6F42C1">toBe</span><span style="color:#24292E">(</span><span style="color:#032F62">'John Doe'</span><span style="color:#24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">  expect</span><span style="color:#24292E">(button).not.</span><span style="color:#6F42C1">toBeDisabled</span><span style="color:#24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">  fireEvent.</span><span style="color:#6F42C1">click</span><span style="color:#24292E">(button);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">  const</span><span style="color:#005CC5"> successMessage</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> screen.</span><span style="color:#6F42C1">getByText</span><span style="color:#24292E">(</span><span style="color:#032F62">/Success!/</span><span style="color:#D73A49">i</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#6F42C1">  expect</span><span style="color:#24292E">(successMessage).</span><span style="color:#6F42C1">toBeInTheDocument</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#24292E">});</span></span></code></pre>
<p>Now you wouldn't know it at first glance but the above test case is used to validate
a form where the user can submit their name. The test technically works, but it does
not communicate it's intent.</p>
<p>I see code like this all the time. Especially when working with UI frameworks like
React, Angular, and Vue. Developers pile assertion upon assertion into one large
test case. And when a new requirement comes along? they just add in yet another
assertion.</p>
<p>Why? because the set-up is <em>done</em>, and bulky, and they don't want to have to rewrite
or duplicate the work.</p>
<chicken-asks>
So how do we fix this?
</chicken-asks>
<magpie-replies>
We break out each assertion into its own test.
</magpie-replies>
<h2>The Refactor</h2>
<pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code class="language-javascript"><span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> { render, screen, fireEvent } </span><span style="color:#D73A49">from</span><span style="color:#032F62"> '@testing-library/react'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> { beforeEach, expect, test } </span><span style="color:#D73A49">from</span><span style="color:#032F62"> 'vitest'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> MyComponent </span><span style="color:#D73A49">from</span><span style="color:#032F62"> './MyComponent'</span><span style="color:#24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">describe</span><span style="color:#24292E">(</span><span style="color:#032F62">'User Name Submit Form'</span><span style="color:#24292E">, () </span><span style="color:#D73A49">=></span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">    let</span><span style="color:#24292E"> apiFetchMock;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    beforeEach</span><span style="color:#24292E">(() </span><span style="color:#D73A49">=></span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">        const</span><span style="color:#005CC5"> mockApiData</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> { user: </span><span style="color:#032F62">'John Doe'</span><span style="color:#24292E"> };</span></span>
<span class="line"><span style="color:#24292E">        apiFetchMock </span><span style="color:#D73A49">=</span><span style="color:#24292E"> vi.</span><span style="color:#6F42C1">fn</span><span style="color:#24292E">(() </span><span style="color:#D73A49">=></span><span style="color:#005CC5"> Promise</span><span style="color:#24292E">.</span><span style="color:#6F42C1">resolve</span><span style="color:#24292E">(mockApiData));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">        render</span><span style="color:#24292E">(&#x3C;</span><span style="color:#005CC5">MyComponent</span><span style="color:#6F42C1"> fetchData</span><span style="color:#D73A49">=</span><span style="color:#24292E">{apiFetchMock} />);</span></span>
<span class="line"><span style="color:#24292E">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    test</span><span style="color:#24292E">(</span><span style="color:#032F62">'renders header'</span><span style="color:#24292E">, () </span><span style="color:#D73A49">=></span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">        const</span><span style="color:#005CC5"> header</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> screen.</span><span style="color:#6F42C1">getByText</span><span style="color:#24292E">(</span><span style="color:#032F62">/My Dashboard/</span><span style="color:#D73A49">i</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#6F42C1">        expect</span><span style="color:#24292E">(header).</span><span style="color:#6F42C1">toBeInTheDocument</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#24292E">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    test</span><span style="color:#24292E">(</span><span style="color:#032F62">'renders input field'</span><span style="color:#24292E">, () </span><span style="color:#D73A49">=></span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">        const</span><span style="color:#005CC5"> input</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> screen.</span><span style="color:#6F42C1">getByPlaceholderText</span><span style="color:#24292E">(</span><span style="color:#032F62">'Enter your name'</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#6F42C1">        expect</span><span style="color:#24292E">(input).</span><span style="color:#6F42C1">toBeInTheDocument</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#24292E">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    test</span><span style="color:#24292E">(</span><span style="color:#032F62">'initial input field is empty'</span><span style="color:#24292E">, () </span><span style="color:#D73A49">=></span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">        const</span><span style="color:#005CC5"> input</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> screen.</span><span style="color:#6F42C1">getByPlaceholderText</span><span style="color:#24292E">(</span><span style="color:#032F62">'Enter your name'</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#6F42C1">        expect</span><span style="color:#24292E">(input.value).</span><span style="color:#6F42C1">toBe</span><span style="color:#24292E">(</span><span style="color:#032F62">''</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    test</span><span style="color:#24292E">(</span><span style="color:#032F62">'changes input value on user input'</span><span style="color:#24292E">, () </span><span style="color:#D73A49">=></span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">        const</span><span style="color:#005CC5"> input</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> screen.</span><span style="color:#6F42C1">getByPlaceholderText</span><span style="color:#24292E">(</span><span style="color:#032F62">'Enter your name'</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">        fireEvent.</span><span style="color:#6F42C1">change</span><span style="color:#24292E">(input, { target: { value: </span><span style="color:#032F62">'John Doe'</span><span style="color:#24292E"> } });</span></span>
<span class="line"><span style="color:#6F42C1">        expect</span><span style="color:#24292E">(input.value).</span><span style="color:#6F42C1">toBe</span><span style="color:#24292E">(</span><span style="color:#032F62">'John Doe'</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    test</span><span style="color:#24292E">(</span><span style="color:#032F62">'renders submit button'</span><span style="color:#24292E">, () </span><span style="color:#D73A49">=></span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">        const</span><span style="color:#005CC5"> button</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> screen.</span><span style="color:#6F42C1">getByRole</span><span style="color:#24292E">(</span><span style="color:#032F62">'button'</span><span style="color:#24292E">, { name:</span><span style="color:#032F62"> /Submit/</span><span style="color:#D73A49">i</span><span style="color:#24292E"> });</span></span>
<span class="line"><span style="color:#6F42C1">        expect</span><span style="color:#24292E">(button).</span><span style="color:#6F42C1">toBeInTheDocument</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#24292E">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    test</span><span style="color:#24292E">(</span><span style="color:#032F62">'submit button is disabled initially'</span><span style="color:#24292E">, () </span><span style="color:#D73A49">=></span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">        const</span><span style="color:#005CC5"> button</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> screen.</span><span style="color:#6F42C1">getByRole</span><span style="color:#24292E">(</span><span style="color:#032F62">'button'</span><span style="color:#24292E">, { name:</span><span style="color:#032F62"> /Submit/</span><span style="color:#D73A49">i</span><span style="color:#24292E"> });</span></span>
<span class="line"><span style="color:#6F42C1">        expect</span><span style="color:#24292E">(button).</span><span style="color:#6F42C1">toBeDisabled</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#24292E">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    test</span><span style="color:#24292E">(</span><span style="color:#032F62">'submit button is enabled after input change'</span><span style="color:#24292E">, () </span><span style="color:#D73A49">=></span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">        const</span><span style="color:#005CC5"> input</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> screen.</span><span style="color:#6F42C1">getByPlaceholderText</span><span style="color:#24292E">(</span><span style="color:#032F62">'Enter your name'</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">        fireEvent.</span><span style="color:#6F42C1">change</span><span style="color:#24292E">(input, { target: { value: </span><span style="color:#032F62">'John Doe'</span><span style="color:#24292E"> } });</span></span>
<span class="line"><span style="color:#D73A49">        const</span><span style="color:#005CC5"> button</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> screen.</span><span style="color:#6F42C1">getByRole</span><span style="color:#24292E">(</span><span style="color:#032F62">'button'</span><span style="color:#24292E">, { name:</span><span style="color:#032F62"> /Submit/</span><span style="color:#D73A49">i</span><span style="color:#24292E"> });</span></span>
<span class="line"><span style="color:#6F42C1">        expect</span><span style="color:#24292E">(button).not.</span><span style="color:#6F42C1">toBeDisabled</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#24292E">    });</span></span>
<span class="line"><span style="color:#24292E">});</span></span>
<span class="line"></span></code></pre>
<p>In the above refactor any shared test set up is broken out into a <code>beforeEach</code> hook
and each assertion is given its own test case.</p>
<p>The advantage of doing this becomes immediately clear. The tests now read like a
story. We know exactly what the intent of each test case is, and  we only have to
read a small amount of code to understand the test's logic. To accentuate my point
about read ability. If we were to take the name of each test case and list it out
we would have the following verse.</p>
<pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code class="language-text"><span class="line"><span>User Name Submit Form</span></span>
<span class="line"><span>    renders header</span></span>
<span class="line"><span>    renders input field</span></span>
<span class="line"><span>    initial input field is empty</span></span>
<span class="line"><span>    changes input value on user input</span></span>
<span class="line"><span>    renders submit button</span></span>
<span class="line"><span>    submit button is disabled initially</span></span>
<span class="line"><span>    submit button is enabled after input change</span></span></code></pre>
<p>This reads like a list of requirements. Which is essentially what UI tests are.
Compare this with the story the initial test gave us.</p>
<pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code class="language-text"><span class="line"><span>User Name Submit Form</span></span></code></pre>
<p>Yea, not as descriptive. Who knows what that test does. Not me.</p>
<p>So in summary, try your best to write your test cases as if they were telling a
story. Try to stick to one assertion per test, and split out any shared logic into
hooks, like <code>beforeEach</code> and <code>beforeAll</code>.</p>
</div>
                    <footer>
                        <p>Until next time,</p>
                        <p>— Brian</p>
                    </footer>
                </article>
            </div>
        </main>
        <footer class="site-footer gray-bg">
    <div class="content-md mx-auto px-sm">
        <p class="my-auto py-sm">
            Since August 4th, 2023. All words by Brian
            Douglas.
        </p>
    </div>
</footer>

        <script src="/scripts/chicken-and-magpie.js"></script>
    </body>
</html>
