<!DOCTYPE html>
<html lang="en" class="Robyn">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Title -->
    <title>BrianDouglas.ie - Generate OG images for blog posts
    </title>

    <!-- Meta Description -->
    <meta name="description" content="Generate OG images for blog posts" />

    <!-- Keywords -->
    <meta name="keywords" content="Brian Douglas, blog, node,javascript" />

    <!-- Author -->
    <meta name="author" content="Brian Douglas" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="BrianDouglas.ie - Generate OG images for blog posts" />
    <meta property="og:description" content="Generate OG images for blog posts" />
    <meta property="og:url" content="https://www.briandouglas.ie" />
    <meta property="og:image" content="http://www.briandouglas.ie/images/og-images/generate-og-images-for-blog-posts.png" />
    <meta property="og:image:type" content="image/png" />
    <meta property="og:image:width" content="1280" />
    <meta property="og:image:height" content="640" />
    <meta property="og:site_name" content="BrianDouglas.ie" />
    <meta property="og:image:alt" content="A preview image for the post titled 'Generate OG images for blog posts'" />

    <!-- Twitter Meta -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@BrianDouglasIE" />
    <meta name="twitter:title" content="BrianDouglas.ie - Generate OG images for blog posts" />
    <meta name="twitter:description" content="Generate OG images for blog posts" />
    <meta name="twitter:image" content="http://www.briandouglas.ie/images/og-images/generate-og-images-for-blog-posts.png" />

    <!-- Canonical URL -->
    <link rel="canonical" href="https://www.briandouglas.ie" />

    <!-- Favicon (Optional) -->
    <link rel="icon" href="https://www.briandouglas.ie/favicon.ico" type="image/x-icon" />

    <!-- Robots -->
    <meta name="robots" content="index, follow" />

    <!-- Favicon-->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />

    <link rel="stylesheet" href="/styles/briandouglas.ie.css">
</head>

<body class="m-0">
    <div class="wrap content-md mx-auto">
        <header class="site-header">
  <div class="content-md mx-auto px-sm">
    <h1 class="m-0">Brian Douglas</h1>

    <div class="social-links">
      <a href="https://github.com/BrianDouglasIE">
        <svg
          height="32"
          aria-hidden="true"
          viewBox="0 0 24 24"
          version="1.1"
          width="32"
          data-view-component="true"
          class="octicon octicon-mark-github v-align-middle color-fg-default"
        >
          <path
            d="M12.5.75C6.146.75 1 5.896 1 12.25c0 5.089 3.292 9.387 7.863 10.91.575.101.79-.244.79-.546 0-.273-.014-1.178-.014-2.142-2.889.532-3.636-.704-3.866-1.35-.13-.331-.69-1.352-1.18-1.625-.402-.216-.977-.748-.014-.762.906-.014 1.553.834 1.769 1.179 1.035 1.74 2.688 1.25 3.349.948.1-.747.402-1.25.733-1.538-2.559-.287-5.232-1.279-5.232-5.678 0-1.25.445-2.285 1.178-3.09-.115-.288-.517-1.467.115-3.048 0 0 .963-.302 3.163 1.179.92-.259 1.897-.388 2.875-.388.977 0 1.955.13 2.875.388 2.2-1.495 3.162-1.179 3.162-1.179.633 1.581.23 2.76.115 3.048.733.805 1.179 1.825 1.179 3.09 0 4.413-2.688 5.39-5.247 5.678.417.36.776 1.05.776 2.128 0 1.538-.014 2.774-.014 3.162 0 .302.216.662.79.547C20.709 21.637 24 17.324 24 12.25 24 5.896 18.854.75 12.5.75Z"
          ></path>
        </svg>
      </a>
    </div>
  </div>
</header>

            <div class="breadcrumbs">
                <nav aria-label="Breadcrumb" class="content-md mx-auto px-sm">
                    <ol class="list-reset m-0">
                        <li><a href="/">Home</a></li> /
                        <li aria-current="page">
                            Generate OG images for blog posts
                        </li>
                    </ol>
                </nav>
            </div>
            <main>
                <div class="content-md mx-auto px-sm my-md">
                    <article class="post-full">
                        <header>
                            <h2>
                                Generate OG images for blog posts
                            </h2>
                            <p class="post-meta">
                                <time datetime="07/09/2024">
                                    September 7th, 2024
                                </time>
                            </p>
                        </header>
                        <div class="post-content"><p>When sharing an article on social media you will see a preview. The preview uses the html <code>og:image</code> meta tag. In this
article I will demonstrate how I generate a unique <code>og:image</code> for each of my blog posts.</p>
<!-- more -->
<p>The general gist here is that we want to create a method that will take the title of our post and generate an image
with that title text. We will use a template image to place the text into. The template image I use is shown below.
Note the empty space on the right hand side, this is where we will place our blog post title. As recommended by github
I have also left and 80px margin around the content. The dimensions of the image are 1280x640 pixels.</p>
<img class="pure-img" src="/images/open-graph-template.png"  alt="my og:image template"/>
<h2>The Implementation</h2>
<p>In order to write the title of our blog post to the template image we will use the npm package <a href="https://www.npmjs.com/package/pureimage">PureImage</a>.
This package allows us to use the canvas api to draw to a context which we can then export as an image, without loading
up a browser instance.</p>
<magpie-trinket>
He probably leaves out a load of detail in the next section. But the general gist is as follows.
<ul>
    <li>Create a template image that you want to write too</li>
    <li>Install the PureImage package</li>
    <li>Load the desired font intro PureImage</li>
    <li>Draw the text on to the template image using a PureImage context</li>
    <li>Output the new image to the desired location</li>
</ul>
</magpie-trinket>
<h3>Gotcha 1 - Loading the font</h3>
<p>The first gotcha when using <code>PureImage</code> is that there are no fonts loaded by default. So in order to draw text to our image
we must first load the font like so.</p>
<pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code class="language-javascript"><span class="line"><span style="color:#D73A49">import</span><span style="color:#005CC5"> *</span><span style="color:#D73A49"> as</span><span style="color:#24292E"> PImage </span><span style="color:#D73A49">from</span><span style="color:#032F62"> "pureimage"</span><span style="color:#24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> OUT_DIR</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "./docs/images/og-images"</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> FONT</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> PImage.</span><span style="color:#6F42C1">registerFont</span><span style="color:#24292E">(</span></span>
<span class="line"><span style="color:#032F62">  "C:</span><span style="color:#005CC5">\\</span><span style="color:#032F62">Users</span><span style="color:#005CC5">\\</span><span style="color:#032F62">brian</span><span style="color:#005CC5">\\</span><span style="color:#032F62">AppData</span><span style="color:#005CC5">\\</span><span style="color:#032F62">Local</span><span style="color:#005CC5">\\</span><span style="color:#032F62">Microsoft</span><span style="color:#005CC5">\\</span><span style="color:#032F62">Windows</span><span style="color:#005CC5">\\</span><span style="color:#032F62">Fonts</span><span style="color:#005CC5">\\</span><span style="color:#032F62">JetBrainsMono-Bold.ttf"</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#032F62">  "MyFont"</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5">FONT</span><span style="color:#24292E">.</span><span style="color:#6F42C1">loadSync</span><span style="color:#24292E">();</span></span></code></pre>
<p>This will load the required font so that we can use it when drawing on our image template.</p>
<h3>Gotcha 2 - Wrapping the text</h3>
<p>The second gotcha is that because we are using the canvas api to draw text, it will not wrap unless we specifically tell
it to do so. To get around this I have used the below method. This is actually a common issue when making browser games
using the canvas. So I was expecting to encounter the problem.</p>
<pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code class="language-javascript"><span class="line"><span style="color:#D73A49">function</span><span style="color:#6F42C1"> wrapText</span><span style="color:#24292E">(</span><span style="color:#E36209">ctx</span><span style="color:#24292E">, </span><span style="color:#E36209">text</span><span style="color:#24292E">, </span><span style="color:#E36209">x</span><span style="color:#24292E">, </span><span style="color:#E36209">y</span><span style="color:#24292E">, </span><span style="color:#E36209">maxWidth</span><span style="color:#24292E">, </span><span style="color:#E36209">lineHeight</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">  const</span><span style="color:#005CC5"> words</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> text.</span><span style="color:#6F42C1">split</span><span style="color:#24292E">(</span><span style="color:#032F62">" "</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#D73A49">  let</span><span style="color:#24292E"> line </span><span style="color:#D73A49">=</span><span style="color:#032F62"> ""</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">  let</span><span style="color:#24292E"> testLine, metrics, testWidth;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">  for</span><span style="color:#24292E"> (</span><span style="color:#D73A49">let</span><span style="color:#24292E"> n </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">; n </span><span style="color:#D73A49">&#x3C;</span><span style="color:#24292E"> words.</span><span style="color:#005CC5">length</span><span style="color:#24292E">; n</span><span style="color:#D73A49">++</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">    testLine </span><span style="color:#D73A49">=</span><span style="color:#24292E"> line </span><span style="color:#D73A49">+</span><span style="color:#24292E"> words[n] </span><span style="color:#D73A49">+</span><span style="color:#032F62"> " "</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">    metrics </span><span style="color:#D73A49">=</span><span style="color:#24292E"> ctx.</span><span style="color:#6F42C1">measureText</span><span style="color:#24292E">(testLine);</span></span>
<span class="line"><span style="color:#24292E">    testWidth </span><span style="color:#D73A49">=</span><span style="color:#24292E"> metrics.width;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    if</span><span style="color:#24292E"> (testWidth </span><span style="color:#D73A49">></span><span style="color:#24292E"> maxWidth </span><span style="color:#D73A49">&#x26;&#x26;</span><span style="color:#24292E"> n </span><span style="color:#D73A49">></span><span style="color:#005CC5"> 0</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">      ctx.</span><span style="color:#6F42C1">fillText</span><span style="color:#24292E">(line, x, y);</span></span>
<span class="line"><span style="color:#24292E">      line </span><span style="color:#D73A49">=</span><span style="color:#24292E"> words[n] </span><span style="color:#D73A49">+</span><span style="color:#032F62"> " "</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">      y </span><span style="color:#D73A49">+=</span><span style="color:#24292E"> lineHeight;</span></span>
<span class="line"><span style="color:#24292E">    } </span><span style="color:#D73A49">else</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">      line </span><span style="color:#D73A49">=</span><span style="color:#24292E"> testLine;</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">  ctx.</span><span style="color:#6F42C1">fillText</span><span style="color:#24292E">(line, x, y);</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<h3>Putting it all together</h3>
<p>Here is the code I use to generate my OG images. It's specific to my use case, but I feel that you, a talented software
engineer, will be able to extract the bits you need.</p>
<p>The main domain specific things here is that my <code>Post</code> class looks something like this.</p>
<pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code class="language-typescript"><span class="line"><span style="color:#D73A49">type</span><span style="color:#6F42C1"> Post</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#E36209">    slug</span><span style="color:#D73A49">:</span><span style="color:#005CC5"> string</span></span>
<span class="line"><span style="color:#E36209">    html</span><span style="color:#D73A49">:</span><span style="color:#005CC5"> string</span></span>
<span class="line"><span style="color:#E36209">    excerpt</span><span style="color:#D73A49">:</span><span style="color:#005CC5"> string</span></span>
<span class="line"><span style="color:#E36209">    data</span><span style="color:#D73A49">:</span><span style="color:#24292E"> { </span><span style="color:#E36209">title</span><span style="color:#D73A49">:</span><span style="color:#005CC5"> string</span><span style="color:#24292E">, </span><span style="color:#E36209">date</span><span style="color:#D73A49">:</span><span style="color:#005CC5"> string</span><span style="color:#24292E">, </span><span style="color:#E36209">tags</span><span style="color:#D73A49">:</span><span style="color:#005CC5"> string</span><span style="color:#24292E">[] }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<p>With that in mind here is the full implementation.</p>
<pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code class="language-javascript"><span class="line"><span style="color:#D73A49">import</span><span style="color:#005CC5"> *</span><span style="color:#D73A49"> as</span><span style="color:#24292E"> PImage </span><span style="color:#D73A49">from</span><span style="color:#032F62"> "pureimage"</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#005CC5"> *</span><span style="color:#D73A49"> as</span><span style="color:#24292E"> fs </span><span style="color:#D73A49">from</span><span style="color:#032F62"> "fs"</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> path </span><span style="color:#D73A49">from</span><span style="color:#032F62"> "node:path"</span><span style="color:#24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> OUT_DIR</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "./docs/images/og-images"</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> FONT</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> PImage.</span><span style="color:#6F42C1">registerFont</span><span style="color:#24292E">(</span></span>
<span class="line"><span style="color:#032F62">  "C:</span><span style="color:#005CC5">\\</span><span style="color:#032F62">Users</span><span style="color:#005CC5">\\</span><span style="color:#032F62">brian</span><span style="color:#005CC5">\\</span><span style="color:#032F62">AppData</span><span style="color:#005CC5">\\</span><span style="color:#032F62">Local</span><span style="color:#005CC5">\\</span><span style="color:#032F62">Microsoft</span><span style="color:#005CC5">\\</span><span style="color:#032F62">Windows</span><span style="color:#005CC5">\\</span><span style="color:#032F62">Fonts</span><span style="color:#005CC5">\\</span><span style="color:#032F62">JetBrainsMono-Bold.ttf"</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#032F62">  "MyFont"</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5">FONT</span><span style="color:#24292E">.</span><span style="color:#6F42C1">loadSync</span><span style="color:#24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">export</span><span style="color:#D73A49"> async</span><span style="color:#D73A49"> function</span><span style="color:#6F42C1"> generateOGImage</span><span style="color:#24292E">(</span><span style="color:#E36209">post</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">  const</span><span style="color:#005CC5"> pImage</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> PImage.</span><span style="color:#6F42C1">make</span><span style="color:#24292E">(</span><span style="color:#005CC5">1280</span><span style="color:#24292E">, </span><span style="color:#005CC5">640</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#D73A49">  const</span><span style="color:#005CC5"> ctx</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> pImage.</span><span style="color:#6F42C1">getContext</span><span style="color:#24292E">(</span><span style="color:#032F62">"2d"</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#D73A49">  const</span><span style="color:#005CC5"> image</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> await</span><span style="color:#24292E"> PImage.</span><span style="color:#6F42C1">decodePNGFromStream</span><span style="color:#24292E">(</span></span>
<span class="line"><span style="color:#24292E">    fs.</span><span style="color:#6F42C1">createReadStream</span><span style="color:#24292E">(</span><span style="color:#032F62">"./theme/assets/images/open-graph-template.png"</span><span style="color:#24292E">),</span></span>
<span class="line"><span style="color:#24292E">  );</span></span>
<span class="line"><span style="color:#24292E">  ctx.</span><span style="color:#6F42C1">drawImage</span><span style="color:#24292E">(image, </span><span style="color:#005CC5">0</span><span style="color:#24292E">, </span><span style="color:#005CC5">0</span><span style="color:#24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">  const</span><span style="color:#005CC5"> text</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> post.data.title;</span></span>
<span class="line"><span style="color:#D73A49">  const</span><span style="color:#005CC5"> maxWidth</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> 700</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">  const</span><span style="color:#005CC5"> lineHeight</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> 80</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">  const</span><span style="color:#005CC5"> x</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> 520</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">  const</span><span style="color:#005CC5"> y</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> 270</span><span style="color:#24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">  ctx.font </span><span style="color:#D73A49">=</span><span style="color:#032F62"> "80px MyFont"</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">  ctx.fillStyle </span><span style="color:#D73A49">=</span><span style="color:#032F62"> "black"</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#6F42C1">  wrapText</span><span style="color:#24292E">(ctx, text, x, y, maxWidth, lineHeight);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">  if</span><span style="color:#24292E"> (</span><span style="color:#D73A49">!</span><span style="color:#24292E">fs.</span><span style="color:#6F42C1">existsSync</span><span style="color:#24292E">(</span><span style="color:#005CC5">OUT_DIR</span><span style="color:#24292E">)) {</span></span>
<span class="line"><span style="color:#24292E">    fs.</span><span style="color:#6F42C1">mkdirSync</span><span style="color:#24292E">(</span><span style="color:#005CC5">OUT_DIR</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">  await</span><span style="color:#24292E"> PImage.</span><span style="color:#6F42C1">encodePNGToStream</span><span style="color:#24292E">(</span></span>
<span class="line"><span style="color:#24292E">    pImage,</span></span>
<span class="line"><span style="color:#24292E">    fs.</span><span style="color:#6F42C1">createWriteStream</span><span style="color:#24292E">(path.</span><span style="color:#6F42C1">join</span><span style="color:#24292E">(</span><span style="color:#005CC5">OUT_DIR</span><span style="color:#24292E">, </span><span style="color:#032F62">`${</span><span style="color:#24292E">post</span><span style="color:#032F62">.</span><span style="color:#24292E">slug</span><span style="color:#032F62">}.png`</span><span style="color:#24292E">)),</span></span>
<span class="line"><span style="color:#24292E">  );</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">function</span><span style="color:#6F42C1"> wrapText</span><span style="color:#24292E">(</span><span style="color:#E36209">ctx</span><span style="color:#24292E">, </span><span style="color:#E36209">text</span><span style="color:#24292E">, </span><span style="color:#E36209">x</span><span style="color:#24292E">, </span><span style="color:#E36209">y</span><span style="color:#24292E">, </span><span style="color:#E36209">maxWidth</span><span style="color:#24292E">, </span><span style="color:#E36209">lineHeight</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">  const</span><span style="color:#005CC5"> words</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> text.</span><span style="color:#6F42C1">split</span><span style="color:#24292E">(</span><span style="color:#032F62">" "</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#D73A49">  let</span><span style="color:#24292E"> line </span><span style="color:#D73A49">=</span><span style="color:#032F62"> ""</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">  let</span><span style="color:#24292E"> testLine, metrics, testWidth;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">  for</span><span style="color:#24292E"> (</span><span style="color:#D73A49">let</span><span style="color:#24292E"> n </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">; n </span><span style="color:#D73A49">&#x3C;</span><span style="color:#24292E"> words.</span><span style="color:#005CC5">length</span><span style="color:#24292E">; n</span><span style="color:#D73A49">++</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">    testLine </span><span style="color:#D73A49">=</span><span style="color:#24292E"> line </span><span style="color:#D73A49">+</span><span style="color:#24292E"> words[n] </span><span style="color:#D73A49">+</span><span style="color:#032F62"> " "</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">    metrics </span><span style="color:#D73A49">=</span><span style="color:#24292E"> ctx.</span><span style="color:#6F42C1">measureText</span><span style="color:#24292E">(testLine);</span></span>
<span class="line"><span style="color:#24292E">    testWidth </span><span style="color:#D73A49">=</span><span style="color:#24292E"> metrics.width;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    if</span><span style="color:#24292E"> (testWidth </span><span style="color:#D73A49">></span><span style="color:#24292E"> maxWidth </span><span style="color:#D73A49">&#x26;&#x26;</span><span style="color:#24292E"> n </span><span style="color:#D73A49">></span><span style="color:#005CC5"> 0</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">      ctx.</span><span style="color:#6F42C1">fillText</span><span style="color:#24292E">(line, x, y);</span></span>
<span class="line"><span style="color:#24292E">      line </span><span style="color:#D73A49">=</span><span style="color:#24292E"> words[n] </span><span style="color:#D73A49">+</span><span style="color:#032F62"> " "</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">      y </span><span style="color:#D73A49">+=</span><span style="color:#24292E"> lineHeight;</span></span>
<span class="line"><span style="color:#24292E">    } </span><span style="color:#D73A49">else</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">      line </span><span style="color:#D73A49">=</span><span style="color:#24292E"> testLine;</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">  ctx.</span><span style="color:#6F42C1">fillText</span><span style="color:#24292E">(line, x, y);</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<h2>The Result</h2>
<p>Now we can call <code>generateOGImage(myPost)</code> and it will generate a unique og image for the supplied post. The supplied
post's title will be drawn on the image. Using this code on the blog post you are currently reading will generate the
below image.</p>
<img class="pure-img" src="/images/og-images/generate-og-images-for-blog-posts.png"  alt="the og:image for this blog"/>
<p>Unfortunately as you can see from the image, the library we used (<code>PureImage</code>) isn't great at rendering fonts. So the font
looks a little choppy. Potentially a different library would do a better job. Alternatively we could use a tool like
webdriver.io or selenium to render the template as html and save it as an image which may yield better results. For me
however, the current implementation will suffice.</p>
</div>
                        <footer>
                            <p>Until next time,</p>
                            <p>â€” Brian</p>
                        </footer>
                    </article>
                </div>
            </main>
            <footer class="site-footer gray-bg">
    <div class="content-md mx-auto px-sm">
        <p class="my-auto py-sm">
            <small>Since August 4th, 2023. All words by Brian
                    Douglas. <a href="mailto:brianwdouglas@proton.me">Have a comment?</a></small>
        </p>
    </div>
</footer>
    </div>
    <script src="/scripts/chicken-and-magpie.js"></script>
    <script src="/scripts/main.js"></script>
</body>

</html>
