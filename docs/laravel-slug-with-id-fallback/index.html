<!DOCTYPE html>
<html lang="en" class="Robyn">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />

        <!-- Title -->
        <title>Brian Douglas' Tech Blog - Slugs with an ID fallback in Laravel</title>

        <!-- Meta Description -->
        <meta name="description" content="Slugs with an ID fallback in Laravel" />

        <!-- Keywords -->
        <meta
            name="keywords"
            content="Brian Douglas, tech blog, laravel"
        />

        <!-- Author -->
        <meta name="author" content="Brian Douglas" />

        <!-- Open Graph / Facebook -->
        <meta property="og:type" content="website" />
        <meta
            property="og:title"
            content="Brian Douglas' Tech Blog - Slugs with an ID fallback in Laravel"
        />
        <meta property="og:description" content="Slugs with an ID fallback in Laravel" />
        <meta property="og:url" content="https://www.briandouglas.ie" />
        <meta
            property="og:image"
            content="https://www.briandouglas.ie/images/og-images/laravel-slug-with-id-fallback.png"
        />
        <meta property="og:site_name" content="Brian Douglas' Tech Blog" />

        <!-- Twitter Meta -->
        <meta name="twitter:card" content="summary_large_image" />
        <meta
            name="twitter:title"
            content="Brian Douglas' Tech Blog - Slugs with an ID fallback in Laravel"
        />
        <meta name="twitter:description" content="Slugs with an ID fallback in Laravel" />
        <meta
            name="twitter:image"
            content="https://www.briandouglas.ie/images/og-images/laravel-slug-with-id-fallback.png"
        />
        <meta name="twitter:site" content="@BrianDouglasIE" />

        <!-- Canonical URL -->
        <link rel="canonical" href="https://www.briandouglas.ie" />

        <!-- Favicon (Optional) -->
        <link
            rel="icon"
            href="https://www.briandouglas.ie/favicon.ico"
            type="image/x-icon"
        />

        <!-- Robots -->
        <meta name="robots" content="index, follow" />

        <!-- Favicon-->
        <link
            rel="apple-touch-icon"
            sizes="180x180"
            href="/apple-touch-icon.png"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="32x32"
            href="/favicon-32x32.png"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="16x16"
            href="/favicon-16x16.png"
        />
        <link rel="manifest" href="/site.webmanifest" />

        <link rel="stylesheet" href="/styles/briandouglas.ie.css">
    </head>
    <body class="m-0">
        <header class="site-header">
    <div class="content-md mx-auto px-sm">
        <h1 class="m-0">Brian Douglas</h1>
    </div>
</header>

        <div class="breadcrumbs">
            <nav aria-label="Breadcrumb" class="content-md mx-auto px-sm">
                <ol class="list-reset m-0">
                    <li><a href="/">Home</a></li> /
                    <li aria-current="page">Slugs with an ID fallback in Laravel</li>
                </ol>
            </nav>
        </div>
        <main>
            <div class="content-md mx-auto px-sm my-md">
                <article class="post-full">
                    <header>
                        <h2>Slugs with an ID fallback in Laravel</h2>
                        <p class="post-meta">
                            <time datetime="12/06/2024"
                            >June 12th, 2024</time>
                        </p>
                    </header>
                    <div class="post-content"><p>Slugs make a URL look legit. No one wants to click on a link that reads like <code>https://mysite.com/blog/1</code>. I'd definitely get hacked if I clicked that. But what if it read <code>https://mysite.com/blog/1/some-awesome-content</code>. Now that looks trustworthy. I'm definitely gonna see some awesome content if I click that link.</p>
<!-- more -->
<h2>Naive Way</h2>
<p>So how do we implement it? Well we could use the <code>blog</code> resource's title. Laravel provides a <code>Str::slug</code> helper which takes a string and <em>sluggifies</em> it. Meaning <code>My Awesome Blog Post</code> becomes <code>my-awesome-blog-post</code>. This seems like a great idea. Let's update our <code>Blog</code> model so that when it is saved it sets a <code>slug</code> value based on the title.</p>
<pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code class="language-php"><span class="line"><span style="color:#D73A49">use</span><span style="color:#005CC5"> Illuminate\Support\Str</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">use</span><span style="color:#005CC5"> Illuminate\Database\Eloquent\Model</span><span style="color:#24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">class</span><span style="color:#6F42C1"> Blog</span><span style="color:#D73A49"> extends</span><span style="color:#6F42C1"> Model</span></span>
<span class="line"><span style="color:#24292E">{</span></span>
<span class="line"><span style="color:#D73A49">    protected</span><span style="color:#D73A49"> static</span><span style="color:#D73A49"> function</span><span style="color:#6F42C1"> boot</span><span style="color:#24292E">()</span></span>
<span class="line"><span style="color:#24292E">    {</span></span>
<span class="line"><span style="color:#D73A49">        parent::</span><span style="color:#6F42C1">boot</span><span style="color:#24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">        static::</span><span style="color:#6F42C1">saving</span><span style="color:#24292E">(</span><span style="color:#D73A49">function</span><span style="color:#24292E"> ($model) {</span></span>
<span class="line"><span style="color:#D73A49">            if</span><span style="color:#24292E"> (</span><span style="color:#005CC5">empty</span><span style="color:#24292E">($model</span><span style="color:#D73A49">-></span><span style="color:#24292E">slug)) {</span></span>
<span class="line"><span style="color:#24292E">                $model</span><span style="color:#D73A49">-></span><span style="color:#24292E">slug </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> Str</span><span style="color:#D73A49">::</span><span style="color:#6F42C1">slug</span><span style="color:#24292E">($model</span><span style="color:#D73A49">-></span><span style="color:#24292E">title);</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        });</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<p>Now we can implement the resource's <code>show</code> route like so:</p>
<pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code class="language-php"><span class="line"><span style="color:#D73A49">public</span><span style="color:#D73A49"> function</span><span style="color:#6F42C1"> show</span><span style="color:#24292E">(</span><span style="color:#D73A49">string</span><span style="color:#24292E"> $slug)</span></span>
<span class="line"><span style="color:#24292E">{</span></span>
<span class="line"><span style="color:#D73A49">    return</span><span style="color:#005CC5"> Blog</span><span style="color:#D73A49">::</span><span style="color:#6F42C1">withSlug</span><span style="color:#24292E">($slug)</span><span style="color:#D73A49">-></span><span style="color:#6F42C1">first</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<p>Awesome. What a completely foolproof implementation.</p>
<chicken-asks>
But what if we update the title?!?
</chicken-asks>
<magpie-replies>
If the title is updated the `slug` may no longer match the content.
</magpie-replies>
<chicken-asks>
Or worse, the `slug` might update too!
</chicken-asks>
<magpie-replies>
Then the previous url will return a 404, which may break embedded content.
</magpie-replies>
<h2>The Smart Way</h2>
<p>Yes, so not foolproof after all. The <code>title</code> of the blog may change. So it's not something we want to base our urls off, because we don't want our urls to change.</p>
<p>So what shouldn't change about our blog? it's id. At the start of this article we showed an ugly url <code>https://mysite.com/blog/1</code>. The good thing about this <em>ugly</em> url is it shouldn't change. By visiting it you will always view the blog with id 1. The downside is it's not descriptive. So let's combine the unique identifier of the id with the slug based of the blog's title. By doing this we get a url like so, <code>https://mysite.com/blog/1/my-awesome-content</code>. The trick here is that the slug part of the url is just for aesthetics. It gives the user an idea of what the blog with id 1 might be about. Let's implement this in Laravel so that the url works but uses the id solely to get the blog and redirects to the updated slug if the title changes.</p>
<h3>The Code</h3>
<p>We can achieve the above scenario like so. Firstly, in our routes file we will specify the following show route.</p>
<pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code class="language-php"><span class="line"><span style="color:#005CC5">Route</span><span style="color:#D73A49">::</span><span style="color:#6F42C1">get</span><span style="color:#24292E">(</span><span style="color:#032F62">'blog/{blog}/{slug?}'</span><span style="color:#24292E">, [</span><span style="color:#005CC5">BlogController</span><span style="color:#D73A49">::class</span><span style="color:#24292E">, </span><span style="color:#032F62">'show'</span><span style="color:#24292E">])</span><span style="color:#D73A49">-></span><span style="color:#6F42C1">name</span><span style="color:#24292E">(</span><span style="color:#032F62">'blog.show'</span><span style="color:#24292E">);</span></span></code></pre>
<p>Now we'll update our <code>Blog</code> model to contain a helper method, that constructs the new show route.</p>
<pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code class="language-php"><span class="line"><span style="color:#D73A49">use</span><span style="color:#005CC5"> Illuminate\Support\Str</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">use</span><span style="color:#005CC5"> Illuminate\Database\Eloquent\Model</span><span style="color:#24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">class</span><span style="color:#6F42C1"> Blog</span><span style="color:#D73A49"> extends</span><span style="color:#6F42C1"> Model</span></span>
<span class="line"><span style="color:#24292E">{</span></span>
<span class="line"><span style="color:#D73A49">    public</span><span style="color:#D73A49"> function</span><span style="color:#6F42C1"> showRoute</span><span style="color:#24292E">(</span><span style="color:#D73A49">array</span><span style="color:#24292E"> $parameters </span><span style="color:#D73A49">=</span><span style="color:#24292E"> [])</span></span>
<span class="line"><span style="color:#24292E">    {</span></span>
<span class="line"><span style="color:#D73A49">        return</span><span style="color:#6F42C1"> route</span><span style="color:#24292E">(</span><span style="color:#032F62">'blog.show'</span><span style="color:#24292E">, [</span><span style="color:#005CC5">$this</span><span style="color:#24292E">, </span><span style="color:#005CC5">Str</span><span style="color:#D73A49">::</span><span style="color:#6F42C1">slug</span><span style="color:#24292E">(</span><span style="color:#005CC5">$this</span><span style="color:#D73A49">-></span><span style="color:#24292E">title), </span><span style="color:#D73A49">...</span><span style="color:#24292E">$parameters]);</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<p>Finally, in the <code>show</code> method of our <code>BlogController</code> we will add the following.</p>
<pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code class="language-php"><span class="line"><span style="color:#D73A49">public</span><span style="color:#D73A49"> function</span><span style="color:#6F42C1"> show</span><span style="color:#24292E">(</span><span style="color:#005CC5">Request</span><span style="color:#24292E"> $request, </span><span style="color:#005CC5">Blog</span><span style="color:#24292E"> $blog)</span></span>
<span class="line"><span style="color:#24292E">{</span></span>
<span class="line"><span style="color:#D73A49">    if</span><span style="color:#24292E"> (</span><span style="color:#D73A49">!</span><span style="color:#005CC5"> Str</span><span style="color:#D73A49">::</span><span style="color:#6F42C1">contains</span><span style="color:#24292E">($blog</span><span style="color:#D73A49">-></span><span style="color:#6F42C1">showRoute</span><span style="color:#24292E">(), $request</span><span style="color:#D73A49">-></span><span style="color:#6F42C1">path</span><span style="color:#24292E">())) {</span></span>
<span class="line"><span style="color:#D73A49">        return</span><span style="color:#6F42C1"> redirect</span><span style="color:#24292E">($blog</span><span style="color:#D73A49">-></span><span style="color:#6F42C1">showRoute</span><span style="color:#24292E">($request</span><span style="color:#D73A49">-></span><span style="color:#6F42C1">query</span><span style="color:#24292E">()), </span><span style="color:#6F42C1">status</span><span style="color:#24292E">: </span><span style="color:#005CC5">301</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    return</span><span style="color:#6F42C1"> view</span><span style="color:#24292E">(</span><span style="color:#032F62">'blog.show'</span><span style="color:#24292E">, </span><span style="color:#005CC5">compact</span><span style="color:#24292E">(</span><span style="color:#032F62">'blog'</span><span style="color:#24292E">));</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<p>In the above <code>show</code> method, Laravel's route model binding is used to find the correct blog based on the id supplied. We then add an extra check to make sure the <code>$request-&gt;path()</code> matches the <code>showRoute()</code>. If it does not we redirect to the correct <code>showRoute()</code> with a status of <code>301 Moved Permanently</code> to let the browser know the slug has updated.</p>
</div>
                    <footer>
                        <p>Until next time,</p>
                        <p>— Brian</p>
                    </footer>
                </article>
            </div>
        </main>
        <footer class="site-footer gray-bg">
    <div class="content-md mx-auto px-sm">
        <p class="my-auto py-sm">
            Since August 4th, 2023. All words by Brian
            Douglas.
        </p>
    </div>
</footer>

        <script src="/scripts/chicken-and-magpie.js"></script>
    </body>
</html>
